# 2024/10/10 ~
## 1. 상태패턴 리팩토링
- 기존의 방식보다 상태패턴으로 현재상태에 따라 제어하는게 더 보기 편하고 좋아보여서 리팩토링을 진행함
- 이전과 달리 클래스 형식으로 상태를 나누어서 더욱 확실하게 상태를 구분하였음
<br>![image](https://github.com/user-attachments/assets/8efd2504-471d-4b5b-9d13-7f3f4435cdb4)
- Interface 를 활용하여 fox의 현재상태를 전환하도록 하였음
<br>![image](https://github.com/user-attachments/assets/e2ec5b40-97c9-4920-8b1c-9fe6e96d5647)
![image](https://github.com/user-attachments/assets/709c74df-b358-4271-8831-673bf651b965)

- foxController 클래스를 기준으로 상태를 변화시키고 메서드를 통하여 필요한 기능을 각 상태 클래스에서 실행할 수 있도록 하였음
<br>![image](https://github.com/user-attachments/assets/48a633bd-c760-4580-b138-3d540b71f20c)

## 2. 공 생성
- 레퍼런스 게임처럼 공 오브젝트를 생성하고 던지기 기능을 구현하기 위하여 버튼을 누르면 공을 생성하도록 하였음
- 버튼을 누를 경우 fox가 버튼방향으로 향하는 버그가 발생
- EventSystem.current.IsPointerOverGameObject(input.GetTouch(0).fingerId)를 통하여 플레이어가 게임오브젝트가 아닌 UI를 클릭하였을 경우를 bool 값으로 반환받음
- 결과값이 false일 경우에만 해당방향으로 이동하도록 하였음(walk상태로 전환)
  <br>![image](https://github.com/user-attachments/assets/dce34291-fdfa-4914-8bd9-109bb0733c4e)
  
=> 현재는 plane에 딱붙어서 이동만되는 상태. 포켓몬go나 레퍼런스 게임처럼 터치를 해도 해당위치에서 움직여야 하도록 로직을 수정할 필요가 있음!

## 3. 공 평면 생성
- 공을 공중에서 드래그 하기 위해 평면을 생성할 필요가 있는데 new Plane의 경우 인자값이 특이하다.
- 이는 평면을 구성하기 위해 최소로 필요한 요소들로 구성이 된다.
> 1) 동일 직선에 있지 않은 3개의 점
> 2) 하나의 직선과 직선에 있지 않은 1개의 점
> 3) 한점에서 만나는 두 직선
> 4) 서로 평행한 두 직선
- 내가 사용할 방법은 이 중 '2) 하나의 직선과 직선에 있지 않은 1개의 점'으로 Plane plane = new Plane( Vector3.forward, transfomr.position )이다.
- Vector3.forward 은 forward방향인 직선을 수직으로 하는 평면.
- 두번째 인자값은 그 평면의 위치를 정한다.
- => Ball의 위치에 forward방향을 수직으로 하는 평면이 생성되게한다.(화면과 평행, ~~기존에는 up방향으로 했다가 원하는 구현방식이 아니어서 수정함~~)
<br>![image](https://github.com/user-attachments/assets/f4602f60-afec-4245-9e43-d8dbab73e51e)

## 4. 공 움직임 구현
- 터치한 순간, 터치하고 드래그 하는 동안, 터치를 끝낸 순간 상태에 나눠서 행동을 각기 달리하여 기능을 구현
- > (1) 터치한 순간 => touch.phase = TouchPhase.Began
  > - ![image](https://github.com/user-attachments/assets/92a056a6-9a84-42f4-8949-b218e3759e5b)
- > (2) 터치하고 드래그 하는 동안 => touch.phase = TouchPhase.Moved
  > - ![image](https://github.com/user-attachments/assets/e8f52e4e-582c-40bb-a4dc-90ad9a33e12d)
- > (3) 터치를 끝냈을 때 => touch.phase = TouchPhase.Ended
  > - ![image](https://github.com/user-attachments/assets/5dc4f31a-d33a-4d3d-b17e-d8259f589289)



## 5. fox 움직임 제한
- 공이 움직이는 중이라면 fox의 움직임을 멈추게 하였음
- ball 스크립트에서 foxController를 참조하여 ballSelect 변수의 bool 값을 변화시킴으로서 foxConroller 스크립트 내에서 OnMove와 OnInput의 작동에 제한을 두는 방식으로 기능을 구현하였음

## 5. 공 던지기 구현
- 공 움직임 구현에서는 드래그만 구현했다면 포켓몬GO의 몬스터볼처럼 투사체 형식으로 공을 던지는 것을 구현하고 싶었음.
- (1) 터치한 순간
- 터치한 순간에 지금 터치한 position을 vector2(스크린좌표) 값으로 저장해두었음 (touch.point)
  <br> ![image](https://github.com/user-attachments/assets/f91b5c6f-b624-4259-96e7-efdbb583d4d6)
- (2) 드래그 중일 때
- 현재 touch.point와 직전 주기의 touch.point를 빼서(거리) Time.deltaTime(시간)으로 나누어 속도를 알아내었음
- 그리고 드래그가 끝나지 않았을 시 다음 주기에도 같은 방식을 반복하기 위해 속도를 알아낸 직후에 그 포인트를 마찬가지로 저장해 둠
 <br>![image](https://github.com/user-attachments/assets/136e970c-b1e1-4ff2-af0c-4d3084a5920f)
- (3) 드래그를 끝냈을 때
- 속도가 향하는 방향의 x값, y값, 앞으로 가기위한 z값을 정규화 하여 방향 벡터로 저장함
- 사진의 주석에 있는대로 (공의 앞방향 + 속도가 향하는 방향) * 속도의 y방향(위로 드래그 했는지, 안했는지, 아래로 드래그 했는지에 따라 낌
